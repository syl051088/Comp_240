## Related reading

Section 3.4 of your textbook is a useful reference for this activity.

## Study assembly code carefully

Now let’s examine the assembly code for `swap.c` and its corresponding assembly file, `swap.s`.   

You previously examined the Makefile, which is more complicated than what you have seen before.  It is designed to build all of the assembly and executable files listed after the files: directive.  The file swap.s has already been created using this Makefile by typing ‘make’ all by itself. Make sure that you understand why this works.

This makefile goes even further and does not have a 'clean' directive, because we do not want to lose the work that you will be doing, which is described below.


**NOTE:** if you use a filename with .s on it, some editors recognize it as an assembly language file and color-code it.  Or you may need to add an extension to your editor for it 

Examine the file swap.s in the editor. You will look at it and compare it to swap.c in the upper left panel.

Study the C code in swap.c. Note that we can assemble a file that doesn’t have a main() in it.  

As a way to understand the code, you will add comments to a copy of the generated `swap.s` code to explain what is happening at each line of code in the swap function.  You should **do this by making a duplicate** of the `swap.s` file generated by make to a new file called `commented_swap.s`, copying the contents of swap.s into it, and editing that file. (You should use a copy so you don’t overwrite your work when using make.) 

First be sure you have a reference and are familiar with what the names of the registers are in 64-bit assembly code (as produced by our compiler, gcc).  These are listed in Figure 3.2 of your textbook and are given in the slides for class.

It might also help to draw out a picture of the memory locations for t0, t1, xp, and yp  and their addresses.  You can try it by assuming that xp and yp are pointers (therefore address numbers) to memory locations that contain values that are of type long int. Figure 3.2 of your textbook, which has a simpler example called exchange,  will likely be helpful if you are confused about how this *swap* function code works.

### commenting assembly code

For the linux GNU assembler, comments in the assembly code can be written like old-style C comments like this:

    /* a comment */

or when they are on one line (including the end of a line of code), they can begin with a #.  However, the editor doesn't seem to color-code them unless they are old-style C as shown above. If you like the color-coding, use that syntax. However, you are free to comment any way you would like for this exercise.

To explain what is happening, it is really useful to know this important information, repeated here from the first activity because it is so important:


### <img src="../img/emblem-important.svg" alt="Important" width="20" align="bottom"> Parameters go into registers

The parameters to a function such as swap automatically get placed in particular registers. By convention, register `%rdi` holds the first parameter, and register `%rsi` holds the second parameter. We'll learn the conventions for more parameters later.

In this case, `%rdi` has xp, which is a pointer, which means it is an **address in memory**. `%rsi` has yp, which is also a pointer, thus holds a memory address.



Let’s examine each line carefully in the swap function. Write comments at the end of each line of  the lines for the swap function in your `commented_swap.s` file to indicate what each line is doing.  Concentrate on the consecutive move instructions, which are the ‘body’ of the code. You can refer to an example in your book in section 3.4.3, including the blue box about C pointers.



## Try int values

Now copy `swap.c` to `swap_int.c`.  Edit the code to change ‘long’ to ‘int’. Add `swap_int.s` to the files: line of the Makefile and you should be able to make it.

### <img src="../img/emblem-important.svg" alt="Important" width="20" align="bottom"> Get file from the server

When you have run make, you should see that you have a new `swap_int.s` file by doing this in the terminal:

    ls

Now what you need to do is to get the file from the remote server where you are logged in back to your laptop's directory. In the left-hand file explorer of VS code, *Right-click on the 2-close-examination directory and choose Sync Remote->Local*. You should see the file `swap_int.s` show up in the directory.

Look at the difference between `swap.s` and `swap_int.s`.  Make sure that you understand and can explain these differences (talk it over with your neighbor in class).


